version: "3.0"

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true ######################


#USER INTENTS:
intents:
  - greet
  - stop
  - thanks
  - affirm
  - deny
  - bot_challenge
  #product info:
  - inform_p_code
  - inform_text
  #inventory & orders:
  - ask_stock_info
  - ask_add_to_order
  #warehouse:
  - ask_wh_update
  - inform_num_pieces
  - inform_add_pieces
  - inform_decr_pieces
  #orders:
  - inform_need_order
  - ask_new_list


#ENTITIES:
#to be captured by NLU:
entities:
  - p_code
  - supplier
  - pieces


#SLOTS:
slots:
  #basics:
  fail:
    type: bool
    influence_conversation: True
    mappings:
    - type: custom

  #0) data identification:
  p_code:
    type: text
    influence_conversation: True
    mappings:
    - type: from_text
      not_intent: stop
      conditions:
      - active_loop: find_prod_form
        requested_slot: p_code
      - active_loop: wh_update_form
        requested_slot: p_code
      - active_loop: write_order_form
        requested_slot: p_code

  supplier:
    type: text
    influence_conversation: True
    mappings:
    - type: from_text
      not_intent: stop
      conditions:
      - active_loop: find_supplier_form
        requested_slot: supplier
  
  p_name:
    type: text
    influence_conversation: False
    mappings:
    - type: custom

  #1) warehouse:
  variation:
    type: categorical
    influence_conversation: False
    values:
    - add
    - decrease
    mappings:
    - type: from_intent
      intent: inform_add_pieces
      value: add
      conditions:
        - active_loop: wh_update_form
          requested_slot: variation
    - type: from_intent
      intent: inform_num_pieces
      value: add
      conditions:
        - active_loop: wh_update_form
          requested_slot: variation
    - type: from_intent
      intent: inform_decr_pieces
      value: decrease
      conditions:
        - active_loop: wh_update_form
          requested_slot: variation
    - type: from_text
      not_intent:
        - inform_add_pieces
        - inform_num_pieces
        - inform_decr_pieces
        - stop
      conditions:
        - active_loop: wh_update_form
          requested_slot: variation
   
  pieces:
    type: float
    influence_conversation: False
    min_value: 0
    max_value: 100
    mappings:
    - type: from_entity
      entity: pieces
      not_intent: stop

  #2) stock:
  need_order:
    type: bool
    influence_conversation: True
    mappings:
    - type: custom

  add_to_order:
    type: bool
    influence_conversation: True
    mappings:
    - type: from_intent
      intent: deny
      value: False
    - type: from_intent
      intent: affirm
      value: True
    - type: from_intent
      intent: inform_add_pieces
      value: True
    - type: from_intent
      intent: inform_num_pieces
      value: True
    - type: from_text
      not_intent:
        - affirm
        - deny
        - stop

  #3) orders:
  new_list:
    type: bool
    influence_conversation: True
    mappings:
    - type: custom

  ord_code:
    type: float
    influence_conversation: False
    min_value: 0
    mappings:
    - type: custom

  ord_date:
    type: text
    influence_conversation: False
    mappings:
    - type: custom

  ord_list:
    type: text
    influence_conversation: False
    mappings:
    - type: custom

  #3.1) read order:
  keep:
    type: categorical
    influence_conversation: False
    values:
    - ok
    - add
    - remove
    mappings:
    - type: from_intent
      intent: affirm
      value: ok
      conditions:
        - active_loop: read_order_form
          requested_slot: keep
    - type: from_intent
      intent: inform_num_pieces
      value: ok
      conditions:
        - active_loop: read_order_form
          requested_slot: keep
    - type: from_intent
      intent: inform_add_pieces
      value: add
      conditions:
        - active_loop: read_order_form
          requested_slot: keep
    - type: from_intent
      intent: inform_decr_pieces
      value: remove
      conditions:
        - active_loop: read_order_form
          requested_slot: keep
    - type: from_intent
      intent: deny
      value: remove
      conditions:
        - active_loop: read_order_form
          requested_slot: keep
    - type: from_text
      not_intent:
        - affirm
        - inform_add_pieces
        - inform_num_pieces
        - inform_decr_pieces
        - deny
        - stop
      conditions:
        - active_loop: read_order_form
          requested_slot: keep
  
  cur_quantity:
    type: float
    influence_conversation: False
    min_value: 0
    mappings:
    - type: custom

  #3.3) suggest_order:
  found:
    type: bool
    influence_conversation: True
    mappings:
    - type: custom

  add_sugg:
    type: bool
    influence_conversation: False
    mappings:
    - type: from_intent
      intent: inform_num_pieces
      value: True
      conditions:
        - active_loop: suggest_order_form
          requested_slot: add_sugg
    - type: from_intent
      intent: inform_add_pieces
      value: True
      conditions:
        - active_loop: suggest_order_form
          requested_slot: add_sugg
    - type: from_intent
      intent: deny
      value: False
      conditions:
        - active_loop: suggest_order_form
          requested_slot: add_sugg
    - type: from_text
      not_intent:
        - inform_add_pieces
        - inform_num_pieces
        - deny
        - stop
      conditions:
        - active_loop: suggest_order_form
          requested_slot: add_sugg


#AGENT'S RESPONSES:
responses:
  utter_greet:
  - text: "Ciao!"
  - text: "Ciao a te!"

  utter_happy:
  - text: "Ottimo! Buon lavoro."

  utter_welcome:
  - text: "Di nulla!"
  - text: "Nulla!"
  - text: "Figurati!"
  - text: "Ma di nulla!"
  - text: "Ma figurati!"

  utter_available:
  - text: "Se ti serve altro mi trovi qui quando vuoi!"
  - text: "Se ti serve altro mi trovi qui."
  - text: "Resto a disposizione!"
  - text: "Chiamami pure quando vuoi!"
  - text: "Alla prossima!"

  utter_ready:
  - text: "Sono pronto!"
  - text: "Certo!"
  - text: "Subito!"
  - text: "Certamente!"
  - text: "Va benissimo!"

  utter_ok:
  - text: "Ok!"
  - text: "Perfetto!"
  - text: "Ricevuto!"
  - text: "Va benissimo!"

  utter_iamabot:
  - text: "Sono Herbie, il tuo shop manager digitale. Sono qui per aiutarti!"

  utter_done:
  - text: "Fatto!"
  - text: "Ho completato!"
  - text: "Completato!"
  - text: "Missione compiuta!"

  utter_please_rephrase:
  - text: "Mmm, non ho capito bene. Potresti ripetere?"

  utter_repeat:
  - text: "Potresti ripetere?"
  - text: "Puoi riprovare?"
  - text: "Prova a precisare!"
  - text: "Riprova da capo!"
  - text: "Riprova!"

  utter_specify:
  - text: "Prova a specificare meglio!"
  - text: "A quale ti riferisci?"
  - text: "A quale di questi ti riferisci?"

  utter_skip:
  - text: "Ok, ignoro!"
  - text: "Ok, salto!"

#product info:
  utter_ask_p_code:
  - text: "Dimmi il prodotto!"
  - text: "Dimmi pure il prodotto!"
  - text: "Vai col prodotto!"

#warehouse:
  utter_ask_variation:
  - text: "Mi dici la variazione dei pezzi?"
  - text: "Variazione?"

  utter_ask_pieces:
  - text: "Quanti pezzi?"
  - text: "Mi dici il numero dei pezzi?"
  - text: "Numero di pezzi?"

  utter_ask_next:
  - text: "Andiamo avanti."
  - text: "Prossimo."
  - text: "Continuiamo."
  - text: "Successivo."

  utter_ask_more:
  - text: "Può servirti altro?"
  - text: "Posso fare qualcos'altro per te?"
  - text: "Cos'altro posso fare?"

  utter_ask_what:
  - text: "Ok! Cosa vuoi che faccia?"
  - text: "Ok! Cosa ti può servire?"
  - text: "Ok! Dimmi cosa posso fare!"

  utter_ask_add_to_order:
  - text: "Vuoi che te lo segni come da ordinare?"
  - text: "Lo includo nel prossimo ordine?"
  - text: "Te lo metto in lista per il prossimo ordine?"

#orders:
  utter_ask_supplier:
  - text: "Mi diresti il nome del produttore?"
  - text: "Qual è il produttore?"
  - text: "Dimmi il nome del produttore!"
  - text: "Quale produttore?"
  
  utter_ready_to_order:
  - text: "Sono pronto a preparare l'ordine per {supplier}!"
  - text: "Prepariamo l'ordine per {supplier}!"

  utter_ask_read:
  - text: "Vuoi che te la rilegga prima di andare avanti?"
  - text: "Vuoi che io te la legga prima di andare avanti?"

  utter_ask_keep_piece:
  - text: "Teniamo in lista?"
  - text: "Tengo?"
  - text: "Confermi?"

  utter_ask_add_piece:
  - text: "Aggiungo alla lista?"
  - text: "Aggiungo?"

  utter_ask_sugg_pieces:
  - text: "Quanti pezzi ordino?"
  - text: "Quanti te ne ordino?"
  - text: "Quanti pezzi ordiniamo?"

  #guidance:
  utter_guidance_wo:
  - text: "Ok! Dimmi, uno alla volta, per quali prodotti vuoi aggiornare le giacenze. Inizia col primo."
  - text: "Certo! Dimmi, uno alla volta, per quali prodotti vuoi aggiornare le giacenze. Iniziamo con il primo."

  utter_guidance_read:
  - text: "Ok! Ti leggo i prodotti che abbiamo segnato: dimmi se tenerli o rimuoverli e quanti pezzi vuoi ordinare! Inizio col primo."
  - text: "Ok! Ti leggo la lista: per ogni prodotto, dimmi se tenerlo o rimuoverlo e quanti pezzi vuoi ordinare! Iniziamo con il primo."

  utter_guidance_write:
  - text: "Dettami tu, uno alla volta, il nome dei prodotti di {supplier} da ordinare. Iniziamo col primo!"
  - text: "Dettami tu, uno alla volta, i prodotti di {supplier} che vuoi ordinare. Iniziamo!"

  utter_ask_suggest_ord:
  - text: "Posso cercarti altri prodotti di {supplier} in esaurimento nel tuo magazzino. Vuoi che te li suggerisca?"
  - text: "Vuoi che ti suggerisca altri prodotti di {supplier} in esaurimento nel tuo magazzino?"

  utter_order_ready:
  - text: "Il tuo ordine per {supplier} è pronto!"
  - text: "Abbiamo completato la lista ordini per {supplier}!"


#AGENT'S CUSTOM ACTIONS:
actions:
  #global slots validation:
  #- action_validate_slot_mappings
  #custom actions:
  - action_reset_all_slots
  - action_reset_ord_slots
  - action_check_wh
  - action_add_to_list
  - action_get_ordlist
  - action_get_newlist
  - action_get_suggestion_list
  - action_ask_keep
  - action_ask_add_sugg
  #forms validation:
  - validate_find_prod_form
  - validate_find_supplier_form
  - validate_wh_update_form
  - validate_read_order_form
  - validate_write_order_form
  - validate_suggest_order_form


#FORMS:
forms:
  #finders:
  find_prod_form:
    required_slots:
    - p_code
  
  find_supplier_form:
    required_slots:
    - supplier

  #loopers:
  wh_update_form:
    required_slots:
    - p_code
    - variation
    - pieces

  #make order:  
  #3.1.a. system-driven read:
  read_order_form:
    required_slots:
    - keep

  #3.1.b. user-driven write:
  write_order_form:
    required_slots:
    - p_code
    - pieces

  #3.2. proactive order suggestions:
  suggest_order_form:
    required_slots:
    - add_sugg

